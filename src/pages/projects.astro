---
import Layout from '../layouts/Layout.astro';
import ProjectsHeroSection from '../components/sections/projects/ProjectsHeroSection.astro';
import ProjectsGridSection from '../components/sections/projects/ProjectsGridSection';
import { portfolioAPI } from '../lib/api';

// Fetch all projects for the grid
const projectsResponse = await portfolioAPI.getProjects();
const allProjects = projectsResponse.success && Array.isArray(projectsResponse.data) ? projectsResponse.data : [];

const stats = {
  totalProjects: allProjects.length,
  techStacks: [...new Set(allProjects.flatMap(p => p.technologies?.map(t => t.name) || []))].length,
  categories: [...new Set(allProjects.map(p => p.type))].length,
};
---

<Layout
  title="Projects Portfolio | David Lopez Full-Stack Developer"
  description="Explore a curated showcase of projects built by David Lopez â€” from freelance work to personal apps and infrastructure experiments. Filter by category or technology stack."
  image="/projects-seo-image.webp"
>
	<ProjectsHeroSection stats={stats} />
	<ProjectsGridSection projects={allProjects} client:load />
</Layout>